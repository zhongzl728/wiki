# الاتصال بالـ Lora - بناءً على وحدة ATK-LORA-01 من شركة ZhengDian Yuan

وحدة ATK-LORA-01 هي وحدة اتصال لاسلكي LORA عن بُعد تتميز بحجمها الصغير واستهلاكها المنخفض للطاقة وأدائها العالي. تم تصميم الوحدة باستخدام شريحة انتشار الطيف SX1278 للترددات اللاسلكية في نطاق ISM الفعّال. تعمل الوحدة في نطاق التردد من 410 ميجاهرتز إلى 441 ميجاهرتز، مع تقسيم بفاصل 1 ميجاهرتز إلى 32 قناة. يمكن تغيير معظم المعلمات مثل معدل الباود وقوة الإرسال ومعدل البيانات في الجو ووضع العمل من خلال أوامر AT عبر واجهة UART، وتدعم الوحدة أيضاً ترقية البرامج.

## المعلمات الأساسية للوحدة

- التردد العامل: من 410 إلى 441 ميجاهرتز مع 32 قناة
- النطاق الصناعي: تعمل بشكل افتراضي عند 433 ميجاهرتز دون الحاجة لتراخيص
- معدل البيانات اللاسلكي: قابل للتعديل بستة مستويات (0.3 و1.2 و2.4 و4.8 و9.6 و19.2 كيلوبت في الثانية)
- طريقة الاتصال: واجهة TTL سلسلة، واجهة UART سلسلة، 8N1 و 8E1 و 8O1، بمعدلات بواود تتراوح من 1200 إلى 115200 بواود (الإعداد الافتراضي هو 9600 و 8N1)
- قوة الإرسال: 100 مللي واط (20 ديسيبل)، يمكن تعديلها بأربعة مستويات (من 0 إلى 3) بزيادة أو نقصان يقارب 3 ديسيبل في كل مستوى
- الجهد الكهربائي: من 3.3 إلى 5 فولت
- التيار الكهربائي: من 2.3 ميكرو أمبير إلى 118 مللي أمبير
  - في وضع الإرسال: 118 مللي أمبير (20 ديسيبل، 100 مللي واط، الجهد 5 فولت)
  - في وضع الاستقبال: 17 مللي أمبير (الوضع 0 والوضع 1)، ويصل إلى حوالي 2.3 ميكرو أمبير (الوضع 2+2S مع التنبيه)
- درجة حرارة التشغيل: من -40 إلى 85 درجة مئوية
- حساسية الاستقبال تصل إلى -136 ديسيبل ميلي واط، ومدى النقل يصل إلى 3000 متر
- ذاكرة FIFO مزدوجة بحجم 512 بايت

## تعريف الواجهات

| الاسم | وضع المدخل/المخرج | الوصف                                                                                                                        |
| ----- | ----------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| MD0   | مدخل              | تكوين معلمات الدخول؛ عند التشغيل يتم استخدامه مع مخرج AUX لدخول وضع ترقية البرامج                                            |
| AUX   | مخرج؛ مدخل        | يُستخدم لإشارة حالة العمل للوحدة واستيقاظ المستخدم للوحدة الخارجية؛ يُستخدم كمدخل مع MD0 عند التشغيل لدخول وضع ترقية البرامج |
| RXD   | مدخل              | مدخل السلسلة TTL، يتصل بمخرج TXD الخارجي                                                                                     |
| TXD   | مخرج              | مخرج السلسلة TTL، يتصل بمدخل RXD الخارجي                                                                                     |
| GND   |                   | الاتصال بالأرض                                                                                                               |
| VCC   |                   | مدخل الطاقة بجهد متراوح بين 3.3 و 5 فولت                                                                                     |

ملاحظات:

1. مستوى جهد الأقطاب للوحدة هو 3.3 فولت، وللتواصل مع متحكم بجهد 5 فولت يجب توفير تحويل مستوى الجهد.
2. وحدة الاتصال اللاسلكية LORA هي وحدة مستوى TTL، لذا يجب توصيلها بمتحكم مع مستوى TTL.

## تكوين الأوضاع

الأقطاب MD0 و AUX لديها

| الوظيفة             | الوصف                          | طريقة الوصول                                                |
| ------------------- | ------------------------------ | ----------------------------------------------------------- |
| وظيفة الإعداد       | تكوين معلمات الوحدة (أوامر AT) | بعد التشغيل، AUX مفصول، و MD0 مرتفع                         |
| وظيفة الاتصال       | للاتصال اللاسلكي               | بعد التشغيل، AUX مفصول، و MD0 مفصول                         |
| وظيفة تحديث البرامج | لتحديث البرامج                 | بعد التشغيل، AUX مرتفع، و MD0 مرتفع، والاحتفاظ لمدة 1 ثانية |

في وضع الاتصال اللاسلكي، يكون مخرج AUX مفصولًا، ويُستخدم لإشارة حالة العمل للوحدة.

## تكوين الوظيفة

في "وظيفة الإعداد"، يجب ضبط واجهة السلسلة على النحو التالي: معدل البتات "115200"، عدد أقطاب البيانات "8"، توقف "1"، بدون أوامر التدقيق. يتم تكوين معلمات عمل الوحدة باستخدام أوامر AT. يُرجى الرجوع إلى الجدول التالي للاطلاع على أوامر AT المتاحة:

| الأمر       | الوظيفة                                        |
| ----------- | ---------------------------------------------- |
| AT          | اختبار استجابة الوحدة                          |
| AT+MODEL?   | استعلام نموذج الجهاز                           |
| AT+CGMR?    | الحصول على إصدار البرامج                       |
| AT+UPDATE   | استعلام ما إذا كان الجهاز في وضع تحديث البرامج |
| ATE1        | تفعيل عرض الأوامر                              |
| ATE0        | تعطيل عرض الأوامر                              |
| AT+RESET    | إعادة تهيئة الوحدة (إعادة التشغيل)             |
| AT+DEFAULT  | استعادة الإعدادات المصنعية                     |
| AT+FLASH=   | حفظ المعلمات                                   |
| AT+ADDR=?   | استعلام نطاق عناوين الجهاز                     |
| AT+ADDR?    | استعلام عنوان الجهاز                           |
| AT+ADDR=    | تكوين عنوان الجهاز                             |
| AT+TPOWER=? | استعلام نطاق قوة الإرسال                       |
| AT+TPOWER?  | استعلام قوة الإرسال                            |
| AT+TPOWER=  | تكوين قوة الإرسال                              |
| AT+CWMODE=? | استعلام نطاق وضع العمل                         |
| AT+CWMODE?  | استعلام وضع العمل                              |
| AT+CWMODE=  | تكوين وضع العمل                                |
| AT+TMODE=?  | استعلام نطاق حالة الإرسال                      |
| AT+TMODE?   | استعلام حالة الإرسال                           |
| AT+TMODE=   | تكوين حالة الإرسال                             |
| AT+WLRATE=? | استعلام نطاق معدل اللاسلك والقناة              |
| AT+WLRATE?  | استعلام معدل اللاسلك والقناة                   |
| AT+WLRATE=  | تكوين معدل اللاسلك والقناة                     |
| AT+WLTIME=? | استعلام نطاق وقت السكون                        |
| AT+WLTIME?  | استعلام وقت السكون                             |
| AT+WLTIME=  | تكوين وقت السكون                               |
| AT+UART=?   | استعلام نطاق إعداد السلسلة                     |
| AT+UART?    | استعلام إعداد السلسلة                          |
| AT+UART=    | تكوين السلسلة                                  |

````markdown
عندما تكون وظيفة التكوين غير نشطة (MD0=0)، سيتم إعادة تكوين الموديول بناءً على المعلمات. خلال عملية التكوين، سيتم الاحتفاظ بمستوى عال لمؤشر AUX، وبعد الانتهاء، ستكون الناتج منخفضًا. سيكون الموديول على وضع الاستراحة.

## وقت السكون

وقت السكون هو الفاصل الزمني بين فترات الاستماع بالنسبة للمستلم وفترات بث إشارة الإيقاظ بالنسبة للمرسل. عندما يكون الموديول في وضع "إيقاظ"، سيتم إضافة تلقائيًا إشارة الإيقاظ (وقت السكون) إلى البيانات المستخدمة قبل البيانات المستخدمة. وعندما يكون الموديول في وضع "اقتصاد الطاقة"، سيكون وقت السكون المكون مع فاصل زمني للاستماع وفقًا للتكوين.

## وضع الجهاز

### وضع عام (الوضع 0)

- البث: يقوم الموديول بتلقي بيانات المستخدم من المنفذ التسلسلي ويقوم بإرسال حزم البيانات اللاسلكية بطول 58 بايت. عندما تصل البيانات المدخلة بواسطة المستخدم إلى 58 بايت، سيبدأ الموديول في البث اللاسلكي. في هذا الوقت، يمكن للمستخدم الاستمرار في إدخال البيانات التي يرغب في إرسالها. إذا كانت البيانات التي يجب نقلها بواسطة المستخدم أقل من 58 بايت، سينتظر الموديول لمدة بايت واحد. إذا لم يتم إدخال بيانات إضافية بواسطة المستخدم في هذه الفترة، سيتم اعتبارها نهاية البيانات. في هذا الوقت، سيقوم الموديول ببث جميع البيانات اللاسلكية. عندما يبدأ الموديول في إرسال الحزمة الأولى من بيانات المستخدم، ستكون مخرج AUX على مستوى عال. عندما يمرر الموديول جميع البيانات عبر رقاقة RF ويبدأ البث، ستكون مخرج AUX على مستوى منخفض. في هذا الوقت، سيكون ذلك مؤشرًا على أن الحزمة الأخيرة من البيانات اللاسلكية قد تم بثها بنجاح، ويمكن للمستخدم الاستمرار في إدخال بيانات تصل إلى 512 بايت. يمكن أن تكون حزم البيانات المرسلة من خلال وضع البث العام قابلة للتلقي من قبل موديول الاستقبال في وضع البث العام أو وضع الاستيقاظ فقط.
- الاستقبال: يبقى الموديول دائمًا مفتوحًا لوظيفة الاستقبال اللاسلكية ويمكن أن يتلقى حزم البيانات المرسلة من وضع البث العام أو وضع الاستيقاظ. بعد تلقي حزم البيانات، ستكون مخرج AUX على مستوى عال. بعد تأخير 2-3 مللي ثانية، سيبدأ الموديول في نقل البيانات اللاسلكية عبر مخرج TXD للمنفذ التسلسلي. بمجرد نقل جميع البيانات اللاسلكية عبر المنفذ التسلسلي، سيكون مخرج AUX على مستوى منخفض.

### وضع الاستيقاظ (الوضع 1)

- البث: يشترط أن تتوافق شروط بث البيانات في هذا الوضع مع وضع البث العام باستثناء وجود إضافة تلقائية لإشارة الاستيقاظ (وقت السكون) قبل كل حزمة بيانات. طول إشارة الاستيقاظ يعتمد على وقت السكون الذي تم تكوينه بواسطة المستخدم. هدف إشارة الاستيقاظ هو إيقاظ موديول الاستقبال الذي

Here is the translation of the provided text into Arabic:

# البث ومراقبة البيانات: من خلال ضبط عنوان الوحدة على 0xFFFF، يمكن استقبال بيانات الوحدات الأخرى على نفس القناة. بمعنى آخر، البيانات المُرسلة يمكن أن تُستلم بواسطة أي وحدة تحمل عنوانًا مختلفًا على نفس القناة، وهذا يُعزز وظيفة البث والاستماع.

## وضع النقل الشفاف

### نقطة لنقطة

![صورة](https://media.wiki-power.com/img/20220118110614.png)

- وحدتين مع نفس العنوان ونفس القناة ونفس معدل النقل اللاسلكي (ليس معدل البت للتسلسل) يمكن لإحداهما أن ترسل، والأخرى يمكن أن تستقبل (يجب أن يكون هناك وحدة واحدة ترسل وأخرى تستقبل).
- يمكن لكل وحدة القيام بالإرسال والاستقبال.
- البيانات تكون شفافة تمامًا، ما ترسله تحصل عليه.

|             | وحدة الإرسال | وحدة الاستقبال |
| ----------- | ------------ | -------------- |
| العدد       | 1            | 1              |
| محتوى النقل | بيانات       | بيانات         |

مثال:

لدينا جهاز A وجهاز B، كلاهما لهما نفس العنوان ونفس القناة، ونفس معدل النقل.  
جهاز A يرسل: AA BB CC DD  
جهاز B يستقبل: AA BB CC DD

النقل الشفاف يكون بسيطًا جدًا، حيث يُستخدم وحدة Lora كمنفذ تسلسلي، بحيث يمكن لجهاز A إرسال البيانات عبر المنفذ، ويمكن لجهاز B استقبالها من خلال المنفذ على النقل الشفاف.

### نقطة لمتعددين

![صورة](https://media.wiki-power.com/img/20220118110709.png)

- وحدات مع نفس العنوان ونفس القناة ونفس معدل النقل اللاسلكي يمكن لأي منها أن يرسل، ويمكن لأي وحدة أخرى أن تستقبل البيانات.
- يمكن لكل وحدة القيام بالإرسال والاستقبال.
- البيانات تكون شفافة تمامًا، ما ترسله تحصل عليه.

|             | وحدة الإرسال | وحدة الاستقبال |
| ----------- | ------------ | -------------- |
| العدد       | 1            | N              |
| محتوى النقل | بيانات       | بيانات         |

الاختلاف بين هذا الوضع ووضع النقل الشفاف نقطة لنقطة هو أنه يُمكن لعدة وحدات استقبال البيانات.

مثال:

لدينا جهاز A إلى F، جميعهم لهم نفس العنوان ونفس القناة، ونفس معدل النقل.  
جهاز A يرسل: AA BB CC DD  
جهاز B إلى F يستقبلون: AA BB CC DD

### البث والاستماع

![صورة](https://media.wiki-power.com/img/20220118110853.png)

- عنوان الوحدة 0xFFFF يعني أن الوحدة في وضع البث والاستماع، حيث يُمكن للبيانات المُرسلة أن تُستقبل من قبل جميع الوحدات الأخرى التي تعمل على نفس معدل النقل ونفس القناة (البث)، وفي الوقت نفسه يُمكن للوحدة أن تُستمع إلى بيانات الوحدات الأخرى على نفس معدل النقل ونفس القناة (الاستماع).
- في وضع البث والاستماع، لا يلزم تطابق العناوين.

|             | وحدة الإرسال | وحدة الاستقبال |
| ----------- | ------------ | -------------- |
| العدد       | 1            | N              |
| محتوى النقل | بيانات       | بيانات         |

الاختلاف بين هذا الوضع ووضع النقل الشفاف نقطة لمتعددين هو أنه يُمكن أن تكون العناوين مختلفة.

![الصورة](https://media.wiki-power.com/img/20220118111903.png)

على سبيل المثال:
جهاز A العنوان 0X1234، القناة 0X17؛
جهاز B العنوان 0xABCD، القناة 0X01؛
جهاز C العنوان 0X1256، القناة 0x13.

جهاز A يرسل: AB CD 01 AA BB CC DD
جهاز B يستقبل: AA BB CC DD
جهاز C يستقبل: لا شيء

جهاز A يرسل: 12 56 13 AA BB CC DD
جهاز B يستقبل: لا شيء
جهاز C يستقبل: AA BB CC DD

#### اختبار بدون كود

احضر جهازين USB إلى TTL، وحدتين LoRa. قم بتوصيلهما بشكل منفصل بواجهة USB إلى TTL (الطاقة، الأرض المشتركة، والاتصال TX/RX)، ثم قم بتوصيل دبليو دبليو MD0 بمصدر الطاقة VCC وقم بتوصيلهما بجهاز الكمبيوتر عبر USB. قم بفتح برنامج التكوين وقم بتكوين البارامترات التالية:

جهاز A:

- وضع عام
- نقل موجي موجه
- معدل البت: 115200 (يجب أن يكون 115200)
- بت التحقق: لا يوجد
- سرعة الهواء: 19.2k
- وقت السكون: 1 ثانية
- عنوان الوحدة: 0
- قناة الاتصال: 0
- طاقة الإرسال: 20 ديسيبل

جهاز B:

- وضع عام
- نقل موجي موجه
- معدل البت: 115200 (يجب أن يكون 115200)
- بت التحقق: لا يوجد
- سرعة الهواء: 19.2k
- وقت السكون: 1 ثانية
- عنوان الوحدة: 65534
- قناة الاتصال: 10
- طاقة الإرسال: 20 ديسيبل

بعد التكوين، انقر على "حفظ التكوين" وقم بنزع دبليو دبليو MD0 ثم قم بفصل الطاقة.

أعد تشغيل الوحدتين مرة أخرى وافتح برنامج التكوين. حدد "HEX" (نظام العد التكعيبي) للإرسال والاستقبال على حد سواء.

في منطقة الإرسال للجهاز A، قم بإدخال `FF FE 0A 11 12 13 14` ثم انقر فوق "إرسال". ستتمكن من استقبال `11 12 13 14` في منطقة الاستقبال للجهاز B. أو يمكنك في الجهاز B إدخال `00 00 00 11 12 13` لتلقي `11 12 13` في منطقة الاستقبال للجهاز A.

يجب ملاحظة أن `FF FE` هو العنوان للجهاز B (65534 بالنظام الست عشري) والقناة هي 10 (بالنظام الست عشري تكتب `0A`). تتضمن البيانات المرسلة عنوان الجهاز العلوي + عنوان الجهاز السفلي + القناة + بيانات المستخدم.

#### اختبار باستخدام الكود

إن نقل النقطة إلى النقطة يتطلب فقط إضافة بايت العنوان إضافي. يمكن تعريفها على النحو التالي:

```c title="main.c"
/* USER CODE BEGIN PV */
uint8_t B_Addr[2] = { 0xFF, 0xFE };
uint8_t B_Chan[1] = { 0x0A };
/* USER CODE END PV */
```
````

بعد تكوين الشيفرة (بيئة مكتبة HAL) مع المنافذ التسلسلية، يمكن إرسال بايت العنوان قبل إرسال البيانات:

```c title="main.c"
HAL_UART_Transmit(&huart1, B_Addr, 2, 0xFFFF);
HAL_UART_Transmit(&huart1, B_Chan, 1, 0xFFFF);
```

بهذا الشكل، يمكن للجهاز المستقبل (الجهاز B) استقبال إطار بيانات مُرسل من الجهاز A (باستثناء بايت العنوان).

### البث والاستماع

![الصورة](https://media.wiki-power.com/img/20220118112544.png)

- عندما يكون عنوان الوحدة هو 0xFFFF، فإن هذه الوحد

I've translated the provided text into Arabic while maintaining the original markdown format:

```markdown
جهاز A عنوانه 0xFFFF والقناة 0x12؛
جهاز B و C عنوانهما 0x1234، والقناة 0x13؛
جهاز D عنوانه 0xAB00، والقناة 0x01؛
جهاز E عنوانه 0xAB01، والقناة 0x12؛
جهاز F عنوانه 0xAB02، والقناة 0x12؛

جهاز A يبث: FF FF 13 AA BB CC DD
جهاز B و C يستقبلان: AA BB CC DD

جهاز A يرسل: AB 00 01 11 22 33 44
جهاز D فقط يستقبل: 11 22 33 44

جهاز E يرسل: AB 02 12 66 77 88 99
جهاز F يستقبل: 66 77 88 99
جهاز A يستمع: 66 77 88 99

## مراجعة وشكر

- [موديل LORA ATK-LORA-01](http://www.openedv.com/docs/modules/iot/atk-lora-01.html)
- [دليل استخدام موديل LORA ATK-LORA من شركة Zheng Dian Yuan](https://www.bilibili.com/video/BV1D44y1t7bn)
- [معلومات وروابط تقنية لموديل LORA ATK-LORA-01 من شركة Zheng Dian Yuan](http://www.openedv.com/thread-309019-1-1.html)
- [طريقة اختبار عمل موديلي LORA في نقل البيانات بشكل موجه (استخدام الكمبيوتر الشخصي للاختبار)](http://www.openedv.com/forum.php?mod=viewthread&tid=288951)
- [مشكلة استقبال موديل ATK-LORA-01 للبيانات اللاسلكية](http://www.openedv.com/forum.php?mod=viewthread&tid=328190&highlight=ATK-LORA-01)

> عنوان النص: <https://wiki-power.com/>
> يتم حماية هذا المقال بموجب اتفاقية [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh)، يُرجى ذكر المصدر عند إعادة النشر.
```

Please note that Arabic text is written from right to left, so the content within the markdown tags appears in the correct order.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
