# تطوير أجهزة STM32F4

سيقوم هذا المقال بشرح نظام MCU الأدنى (الطاقة، الساعة، إعادة التعيين، وضع البدء، إدارة التصحيح) في STM32F4.

## الطاقة

الجهد العامل العادي للSTM32F4 هو 1.8-3.6 فولت (قد ينخفض في بعض الحالات إلى أقل من 1.7 فولت، وهذا مشروح في الكتيب الإرشادي)، ويحتوي على مثبت الجهد الداخلي الذي يزود الجهد الرقمي الداخلي بقيمة 1.2 فولت.

عندما يتم فصل مصدر الطاقة الرئيسي VDD، يمكن توفير الطاقة لساعة RTC والسجلات الاحتياطية من خلال جهد VBAT.

### مقدمة للأرجل

#### الجهد ومرجع الجهد للمحول الرقمي-التناظري (ADC)

من أجل زيادة دقة التحويل، يتوفر لمحول التناظري-الرقمي ADC أجهزة طاقة مستقلة ويمكن تصفيتها بشكل منفصل وعزلها عن الضوضاء على اللوحة الدائرية.

مصدر الجهد لـ ADC يأتي من مخرج الجهد VDDA الذي يجب أن يتصل بنفس الأرضية المزودة بالطاقة بدلاً من VSS.

إذا كانت الدائرة المدمجة للشريحة تحتوي على أكثر من 100 طرف، ستكون هناك أيضاً أرجل VREF+ وVREF- والتي تستخدم لتوصيل مصادر جهد مرجعية خارجية للمحول التناظري-الرقمي. يجب توصيل VREF- بجهد VSSA الداخلي. إذا كان عدد الأرجل أقل من 100، فإن هاتين الدبوسين لن يتم توصيلهما خارجيًا وسيتم توصيلهما داخليًا بجهد VDDA وVSSA.

#### طاقة البطارية الاحتياطية

إذا كان هناك حاجة للحفاظ على محتوى السجلات الاحتياطية بعد انقطاع VDD الرئيسي، يمكن توصيل VBAT ببطارية أو مصدر طاقة آخر.

يمكن أيضًا استخدام VBAT لتوفير الطاقة للساعة RTC، وذلك باستخدام دائرة إعادة التعيين عند الانقطاع المدمجة في وحدة الانقطاع (PDR).

#### مثبت الجهد الداخلي

يبقى مثبت الجهد الداخلي دائمًا قيد التشغيل بعد إعادة التعيين، ويتوفر فيه ثلاثة أوضاع عمل:

- تشغيل: يوفر مثبت الجهد طاقة كاملة بقيمة 1.2 فولت لمجال 1.2 فولت (النواة، والذاكرة، والأجهزة الرقمية).
- توقف: يوفر مثبت الجهد طاقة منخفضة لمجال 1.2 فولت مع الاحتفاظ بمحتوى السجلات و SRAM.
- الاستعداد: تتم إيقاف مثبت الجهد. باستثناء الدائرة في وضع الاستعداد والمجال الاحتياطي، سيتم فقدان محتوى السجلات و SRAM.

### تصميم الدائرة

فيما يلي طرق تصميم أرجل الطاقة:

- **VDD**
  - **السعة الموجبة**: 10 ميكروفاراد كحد أدنى من السعة، بالإضافة إلى مكثف 100 نانوفاراد متصل بجوار كل دبوس VDD.
- **VDDA**
  - **السعة الموجبة**: 100 نانوففاراد + 1 ميكروفاراد.
  - **تصفية الضوضاء التناظرية**: يمكن توصيلها بجهد VDD من خلال حبة مغناطيسية.
- **VREF+**
  - **السعة الموجبة**: إذا تم تفعيل وظيفة VREF+، يجب توصيل مكثف 100 نانوففاراد ومكثف 1 ميكروفاراد.
  - \*\*تصفية

### الساعة الخارجية عالية السرعة (HSE)

يمكن أن تكون مصادر الساعة HSE متاحتين بنوعين: مصدر خارجي نشط (مع مصدر) ومذبذب خزفي / ذو موجات صوتية خارجي (غير نشط).

![صورة](https://media.wiki-power.com/img/20210529145726.png)

#### المصدر الخارجي (التفاف HSE)

إذا تم اختيار إشارة ساعة خارجية نشطة، يجب توفير مصدر ساعة بتردد 1-50 ميجاهرتز، ويتم توصيل OSC_IN بإشارة ساعة خارجية ذات نسبة حجم تقريبًا 50٪ (موجة مربعة أو موجة جيب أو موجة مثلث)، بينما يبقى OSC_OUT في وضع مقاومة عالية.

#### مذبذب خارجي / ذو موجات صوتية (كريستال HSE)

إذا تم اختيار مذبذب خارجي، يمكن أن تكون نطاقات التردد بين 4 ميجاهرتز و26 ميجاهرتز. عند تصميم الدائرة، يجب أن تكون المكثفات الكهربائية الموجودة على الذوات الموجبة والسالبة للمذبذب بالقرب من أرجل المذبذب بحيث يتم تقليل الاستقرار وفقدان الإخراج إلى الحد الأدنى. قيم المكثفات الكهربائية يجب ضبطها بشكل مناسب وفقًا لاختيار المذبذب المختار.

يجب أن يكون لديك مكثفات CL1 و CL2 ذات نفس الحجم (5-25 بيكوفاراد، قيمة نموذجية 25 بيكوفاراد).

### الساعة الخارجية منخفضة السرعة (LSE)

يمكن أن تكون مصادر الساعة LSE متاحتين بنوعين: مصدر خارجي نشط (مع مصدر) ومذبذب خزفي / ذو موجات صوتية خارجي (غير نشط).

![صورة](https://media.wiki-power.com/img/20210529152354.png)

#### المصدر الخارجي (التفاف LSE)

إذا تم اختيار إشارة ساعة خارجية نشطة، يجب توفير مصدر ساعة بتردد أقل من 1 ميجاهرتز، ويتم توصيل OSC32_IN بإشارة ساعة خارجية ذات نسبة حجم تقريبًا 50٪ (موجة مربعة أو موجة جيب أو موجة مثلث)، بينما يبقى OSC32_OUT في وضع مقاومة عالية.

#### مذبذب خارجي / ذو موجات صوتية (كريستال LSE)

إذا تم اختيار مذبذب خارجي، يمكن أن تكون ترددات ما بين 32.768 كيلوهرتز واحدة من مصادر الساعة لساعة RTC. عند تصميم الدائرة، يجب أن تكون المكثفات الكهربائية الموجودة على الذوات الموجبة والسالبة للمذبذب بالقرب من أرجل المذبذب بحيث يتم تقليل الاستقرار وفقدان الإخراج إلى الحد الأدنى. يجب ضبط قيم المكثفات الكهربائية بشكل مناسب وفقًا لاختيار المذبذب المختار.

## وضع البدء

وضع البدء، المعروف أيضًا بوضع الذاتي التحميل. يمكن اختيار ثلاثة أوضاع بشكل مشترك عبر أقابس BOOT0 و BOOT1: البدء من ذاكرة الوصول السريع الداخلية، البدء من ذاكرة النظام، البدء من ذاكرة البرمجة الرئيسية.

يمكن العثور على مزيد من التفاصيل حول وضع البدء في المقالة [وضع البدء في STM32](https://wiki-power.com/STM32%E7%9A%84%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F).

عادةً، يتم توصيل المقاومات القابلة للسحب بالقرب من BOOT0 بقيمة 10 كيلو أوم، وي

![صورة](https://media.wiki-power.com/img/20210529213723.png)

## المراجع والشكر

- [AN4488: البدء في تطوير الأجهزة لمعالجات STM32F4xxxx MCU](https://www.st.com/content/ccc/resource/technical/document/application_note/76/f9/c8/10/8a/33/4b/f0/DM00115714.pdf/files/DM00115714.pdf/jcr:content/translations/en.DM00115714.pdf)

> عنوان النص: <https://wiki-power.com/>
> يتم حماية هذا المقال بموجب اتفاقية [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh)، يُرجى ذكر المصدر عند إعادة النشر.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
